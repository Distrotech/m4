#!/bin/sh

# test.test is part of the GNU m4 testsuite

. ${srcdir}/defs
. ../../tests/config.sh

# cannot perform test without --with-modules
#test -z "$WITH_MODULES" && exit 77

cat ${srcdir}/test.m4 >in

cat <<'EOF' >ok
Test module loaded. 
Test module called.
Dumpdef: 
EOF

cat <<'EOF' >okerr
test:	<test>
EOF

LTDL_LIBRARY_PATH=`cd $srcdir; pwd` M4PATH=$srcdir:$srcdir/../tests $M4 -d in >out 2>err
sed -e "s,^[^:]*[lt-]*m4[.ex]*:,m4:," err >sederr && mv sederr err
$CMP -s out ok && $CMP -s err okerr
